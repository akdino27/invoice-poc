<section class="invoice-list-page">
  <div class="page-header">
    <h1 class="title">Invoices</h1>
    <p class="subtitle">View and manage all your invoices</p>
  </div>

  <!-- Filters & Search -->
  <div class="filters-bar">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Search invoices..." 
        class="search-input"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />
    </div>

    <div class="filter-controls">
      <label>
        Sort by:
        <select class="filter-select" [(ngModel)]="sortBy">
          <option value="invoiceDate">Invoice Date</option>
          <option value="totalAmount">Total Amount</option>
          <option value="vendorName">Vendor Name</option>
          <option value="invoiceNumber">Invoice Number</option>
          <option value="createdAt">Created Date</option>
        </select>
      </label>

      <button 
        class="sort-order-btn"
        (click)="sortOrder.set(sortOrder() === 'asc' ? 'desc' : 'asc')"
        [title]="sortOrder() === 'asc' ? 'Ascending' : 'Descending'">
        {{ sortOrder() === 'asc' ? '↑' : '↓' }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading invoices...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <p class="error-message">{{ error() }}</p>
      <button (click)="loadInvoices()" class="retry-btn">Retry</button>
    </div>
  }

  <!-- Invoice List -->
  @if (!loading() && !error()) {
    @if (filteredInvoices().length === 0) {
      <div class="empty-state">
        <p>No invoices found.</p>
      </div>
    } @else {
      <div class="invoice-table-container">
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Invoice #</th>
              <th>Date</th>
              <th>Vendor</th>
              <th>Bill To</th>
              <th>Total Amount</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (invoice of filteredInvoices(); track invoice.id) {
              <tr>
                <td>{{ invoice.invoiceNumber || 'N/A' }}</td>
                <td>{{ formatDate(invoice.invoiceDate) }}</td>
                <td>{{ invoice.vendorName || 'N/A' }}</td>
                <td>{{ invoice.billToName || 'N/A' }}</td>
                <td class="amount">{{ formatCurrency(invoice.totalAmount) }}</td>
                <td>
                  <a [routerLink]="['/invoices', invoice.id]" class="view-btn">
                    View Details
                  </a>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button 
          class="page-btn"
          [disabled]="currentPage() === 1"
          (click)="onPageChange(currentPage() - 1)">
          Previous
        </button>

        <div class="page-numbers">
          @for (page of getPaginationRange(); track page) {
            @if (page === -1) {
              <span class="ellipsis">...</span>
            } @else {
              <button 
                class="page-number"
                [class.active]="page === currentPage()"
                (click)="onPageChange(page)">
                {{ page }}
              </button>
            }
          }
        </div>

        <button 
          class="page-btn"
          [disabled]="currentPage() === totalPages()"
          (click)="onPageChange(currentPage() + 1)">
          Next
        </button>
      </div>

      <div class="pagination-info">
        Showing 
        {{ (currentPage() - 1) * pageSize() + 1 }} - 
        {{ Math.min(currentPage() * pageSize(), totalInvoices()) }}
        of {{ totalInvoices() }} invoices
      </div>
    }
  }
</section>
