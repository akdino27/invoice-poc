<section class="product-list-page">
  <div class="page-header">
    <h1 class="title">Products</h1>
    <p class="subtitle">Browse all products across your invoices</p>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="filter-group">
      <label for="category">Category</label>
      <select 
        id="category" 
        (change)="onCategoryChange($event)" 
        [value]="selectedCategory()">
        <option value="">All Categories</option>
        @for (cat of categories(); track cat) {
          <option [value]="cat">{{ cat }}</option>
        }
      </select>
    </div>

    <div class="filter-group">
      <label for="search">Search</label>
      <input 
        type="text" 
        id="search"
        placeholder="Search products..."
        (input)="onSearchChange($event)"
        [value]="searchTerm()" />
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading products...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <p class="error-message">{{ error() }}</p>
      <button (click)="loadProducts()" class="retry-btn">Retry</button>
    </div>
  }

  <!-- Products Grid -->
  @if (!loading() && !error()) {
    @if (products().length === 0) {
      <div class="empty-state">
        <p>No products found.</p>
      </div>
    } @else {
      <div class="products-grid">
        @for (product of products(); track product.id) {
          <div class="product-card">
            <div class="product-header">
              <div class="product-name">{{ product.productName }}</div>
              <div class="product-id">{{ product.productId }}</div>
            </div>

            @if (product.category) {
              <div class="product-category">{{ product.category }}</div>
            }

            <div class="product-stats">
              <div class="stat-row">
                <span class="stat-label">Revenue</span>
                <span class="stat-value">{{ formatCurrency(product.totalRevenue) }}</span>
              </div>

              <div class="stat-row">
                <span class="stat-label">Quantity Sold</span>
                <span class="stat-value">{{ formatNumber(product.totalQuantitySold) }}</span>
              </div>

              <div class="stat-row">
                <span class="stat-label">Invoices</span>
                <span class="stat-value">{{ product.invoiceCount }}</span>
              </div>

              @if (product.defaultUnitRate) {
                <div class="stat-row">
                  <span class="stat-label">Unit Rate</span>
                  <span class="stat-value">{{ formatCurrency(product.defaultUnitRate) }}</span>
                </div>
              }
            </div>

            <div class="product-footer">
              <span class="last-sold">Last sold: {{ formatDate(product.lastSoldDate) }}</span>
            </div>
          </div>
        }
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button 
          (click)="prevPage()" 
          [disabled]="currentPage() === 1"
          class="page-btn">
          Previous
        </button>
        
        <span class="page-info">
          Page {{ currentPage() }} of {{ totalPages() }} ({{ totalProducts() }} total)
        </span>
        
        <button 
          (click)="nextPage()" 
          [disabled]="currentPage() === totalPages()"
          class="page-btn">
          Next
        </button>
      </div>
    }
  }
</section>
